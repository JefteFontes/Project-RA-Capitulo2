<!DOCTYPE html>
<html>
<head>
  <title>AR Barco Viking Interativo</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>

  <style>
    body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: Arial, Helvetica, sans-serif; }
    .instruction { text-align: center;
      position: fixed;
      z-index: 9999;
      background: rgba(255, 255, 255, 0.9);
      font-size: 1rem;
      padding: 1rem;
      width: 90%;
      max-width: 400px;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: background-color 0.5s; }
    a { text-decoration: underline; color: #333; }
    
  </style>
</head>

<body>
  <div class="instruction">
    Aponte a câmera para o marcador Hiro
  </div>

  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" gesture-detector>
    <a-entity camera cursor="rayOrigin: mouse; fuse:false" raycaster="objects: .tocavel"></a-entity>

    <a-marker id="hiroMarker" preset="hiro">
      <a-entity 
          id="barcoviking" 
          class="tocavel" 
          gesture-handler 
          gltf-model="url(gislinge_viking_boat.glb)"
          scale="0.007 0.007 0.007" 
          position="0 0.5 0"

          animation__lunge="property: position; from: 0 0.5 0; to: 0 0.6 -0.3; dur: 500; dir: alternate; loop: 1; startEvents: lunge; easing: easeOutQuad"

          animation__spin="property: rotation; to: 0 360 0; dur: 4000; autoplay: false; loop: true; easing: linear; resumeEvents: mousedown; pauseEvents: mouseup"
      >
      </a-entity>
    </a-marker>
  </a-scene>

  <script>
    const marker = document.querySelector("#hiroMarker");
    const mensagemHeroUI = document.querySelector('.instruction');

    marker.addEventListener("markerFound", () => {
      mensagemHeroUI.style.display = 'none';
      instrucoesUI.style.display = 'block';
    });
    marker.addEventListener("markerLost", () => {
      mensagemHeroUI.style.display = 'block';
      instrucoesUI.style.display = 'none';
    });

    const barco = document.querySelector("#barcoviking");

    // Lógica para evitar que a animação de avançar dispare durante um gesto
    let isDragging = false;
    barco.addEventListener("gesturestart", () => { isDragging = true; });
    barco.addEventListener("gestureend", () => { isDragging = false; });

    // Função que dispara a animação de avançar
    const dispararAnimacao = () => {
      if (!isDragging) {
        barco.emit("lunge");
      }
    };
    
    // Adiciona os listeners para o toque rápido
    barco.addEventListener("touchstart", dispararAnimacao);
    barco.addEventListener("click", dispararAnimacao);
  </script>
</body>
</html>